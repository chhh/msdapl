<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
      "http://ibatis.apache.org/dtd/sql-map-2.dtd"> 
<sqlMap namespace="MsSearchMod"> 


	<typeAlias alias="MsSearchStaticMod" type="org.yeastrc.ms.dto.MsPeptideSearchStaticMod"/>
	<typeAlias alias="MsSearchDynaMod" type="org.yeastrc.ms.dto.MsPeptideSearchDynamicMod"/>
	<typeAlias alias="MsSearchResultDynaMod" type="org.yeastrc.ms.dto.MsSearchResultDynamicMod"/>
	<typeAlias alias="MsSearchModDb" type="org.yeastrc.ms.dto.MsPeptideSearchModDB" />
	
	
	<resultMap class="MsSearchStaticMod" id="msStaticModResult">
		<result property="id" column="id"/>
		<result property="searchId" column="searchID"/>
		<result property="modifiedResidueString" column="residue" javaType="java.lang.String"/>
		<result property="modificationMass" column="modifier"/>
	</resultMap>
	
	<!-- if symbol is NULL we will return an empty String and the default value (\u0000)
	     for modificationSymbol will be used 
	-->
	<resultMap class="MsSearchDynaMod" extends="msStaticModResult" id="msDynaModResult">
		<result property="modificationSymbolString" column="symbol" javaType="java.lang.String" nullValue=""/>
	</resultMap>
	
	<resultMap class="MsSearchResultDynaMod" id="msResultDynaModResult">
		<result property="modificationId" column="modID"/>
		<result property="resultId" column="resultID"/>
		<result property="modifiedResidueString" column="residue" javaType="java.lang.String"/>
		<result property="modificationMass" column="modifier"/>
		<result property="modificationSymbolString" column="symbol" javaType="java.lang.String" nullValue=""/>
		<result property="modifiedPosition" column="position"/>
		
		
	</resultMap>
	
	<parameterMap class="MsSearchModDb" id="msStaticModParam">
		<parameter property="searchId" jdbcType="INTEGER" nullValue="0"/>
		<parameter property="mod.modifiedResidueString" jdbcType="CHAR"/>
		<parameter property="mod.modificationMass" jdbcType="DECIMAL"/>
	</parameterMap>
	
	<parameterMap class="MsSearchModDb" id="msDynaModParam">
		<parameter property="searchId" jdbcType="INTEGER" nullValue="0"/>
		<parameter property="mod.modifiedResidueString" jdbcType="CHAR"/>
		<parameter property="mod.modificationMass" jdbcType="DECIMAL"/>
		<parameter property="mod.modificationSymbolString" jdbcType="CHAR"/>
	</parameterMap>
	
	<!-- ================================================================================= -->
	<!-- QUERIES FOR STATIC MODIFICATIONS -->
	<!-- ================================================================================= -->
    <select id="selectStaticModsForSearch" resultMap="msStaticModResult" parameterClass="Integer">
    	SELECT * FROM msPeptideSearchStaticMod WHERE searchID= #id#
    </select>
    
    <insert id="insertStaticMod" parameterMap="msStaticModParam">
    	INSERT INTO msPeptideSearchStaticMod (
    	searchID,
    	residue,
    	modifier)
    	VALUES (?,?,?)
    </insert>
    
    <delete id="deleteStaticModsForSearch" parameterClass="Integer">
		DELETE FROM msPeptideSearchStaticMod WHERE searchID=#id#
    </delete>
    
	
	<!-- ================================================================================= -->
	<!-- QUERIES FOR DYNAMIC MODIFICATIONS -->
	<!-- ================================================================================= -->
	<select id="selectDynaModIdsForSearch" resultClass="Integer" parameterClass="Integer">
    	SELECT id FROM msPeptideSearchDynamicMod WHERE searchID= #id#
    </select>
    
    <select id="selectDynaModsForSearch" resultMap="msDynaModResult" parameterClass="Integer">
    	SELECT * FROM msPeptideSearchDynamicMod WHERE searchID= #id#
    </select>
    
    <insert id="insertDynaMod" parameterMap="msDynaModParam">
    	INSERT INTO msPeptideSearchDynamicMod (
    	searchID,
    	residue,
    	modifier,
    	symbol)
    	VALUES (?,?,?,?)
    	<selectKey resultClass="int">
      		select last_insert_id() as id
    	</selectKey>
    </insert>
    
     <delete id="deleteDynaModsForSearch" parameterClass="Integer">
		DELETE FROM msPeptideSearchDynamicMod WHERE searchID=#id#
    </delete>
    
    
    <!-- ================================================================================= -->
	<!-- QUERIES FOR DYNAMIC MODIFICATIONS (FOR A SEARCH RESULT) -->
	<!-- ================================================================================= -->
    <select id="selectDynaModsForSearchResult" resultMap="msResultDynaModResult" parameterClass="Integer">
    	SELECT sMod.residue, sMod.modifier, sMod.symbol, rMod.modID, rMod.resultID, rMod.position
    	FROM msPeptideSearchDynamicMod AS sMod, msDynamicModResult AS rMod
    	WHERE sMod.id = rMod.modID
    	AND rMod.resultID= #id#
    </select>
    
    
    <insert id="insertResultDynaMod" parameterClass="java.util.Map">
    	INSERT INTO msDynamicModResult (
    	modID,
    	resultID,
    	position)
    	VALUES (#modId#, #resultId#, #position#)
    </insert>
    
    <delete id="deleteDynaModsForModIds" parameterClass="String">
		DELETE FROM msDynamicModResult WHERE modID IN $idString$
    </delete>
    
    <delete id="deleteDynaModsForSearchResult" parameterClass="Integer">
		DELETE FROM msDynamicModResult WHERE resultID = #resultId#
    </delete>
    
</sqlMap>