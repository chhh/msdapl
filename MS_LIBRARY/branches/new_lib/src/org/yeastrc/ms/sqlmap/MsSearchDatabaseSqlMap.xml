<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
      "http://ibatis.apache.org/dtd/sql-map-2.dtd"> 
<sqlMap namespace="MsDatabase"> 


	<typeAlias alias="MsDatabase" type="org.yeastrc.ms.dto.MsSequenceDatabase"/>
	
	
	<resultMap class="MsDatabase" id="msDatabaseResult">
		<result property="id" column="id"/>
		<result property="serverAddress" column="serverAddress"/>
		<result property="serverPath" column="serverPath"/>
		<result property="sequenceLength" column="sequenceLength" nullValue="0"/>
		<result property="proteinCount" column="proteinCount" nullValue="0"/>
	</resultMap>
	
	
	
	<parameterMap class="MsDatabase" id="msDatabaseParam">
		<parameter property="serverAddress" jdbcType="VARCHAR"/>
		<parameter property="serverPath" jdbcType="VARCHAR"/>
		<parameter property="sequenceLength" jdbcType="INTEGER" />
		<parameter property="proteinCount" jdbcType="INTEGER" />
	</parameterMap>
	
	
	<!-- ================================================================================= -->
	<!-- QUERIES INVOLVING ONLY msSequenceDatabaseDetails TABLE -->
	<!-- ================================================================================= -->
    <select id="selectDatabaseIdMatchAllCols" resultClass="Integer" parameterClass="MsDatabase">
    	SELECT id FROM msSequenceDatabaseDetail WHERE 
    	<dynamic open="serverAddress">
    		<isNull property="serverAddress">
    			IS NULL
    		</isNull>
    		<isNotNull property="serverAddress">
    			= #serverAddress#
    		</isNotNull>
    	</dynamic>
    	<dynamic open="AND serverPath">
    		<isNull property="serverPath">
    			IS NULL
    		</isNull>
    		<isNotNull property="serverPath">
    			= #serverPath#
    		</isNotNull>
    	</dynamic>
    	AND sequenceLength= #sequenceLength#
    	AND proteinCount = #proteinCount#
    </select>
    
    <insert id="insertDatabase" parameterMap="msDatabaseParam">
    	INSERT INTO msSequenceDatabaseDetail (
    	serverAddress,
    	serverPath,
    	sequenceLength,
    	proteinCount)
    	VALUES (?,?,?,?)
    	<selectKey keyProperty="id" resultClass="int">
    		select last_insert_id() as id
    	</selectKey>
    </insert>
    
    <!-- ================================================================================= -->
	<!-- QUERIES INVOLVING ONLY msSearchDatabase TABLE -->
	<!-- ================================================================================= -->
    <insert id="insertSearchDatabase" parameterClass="java.util.Map">
    	INSERT INTO msSearchDatabase (searchID, databaseID) values(#searchId#, #databaseId#)
    </insert>
    
    <delete id="deleteSearchDatabases" parameterClass="Integer">
		DELETE FROM msSearchDatabase WHERE searchID=#id#
    </delete>
	
	<!-- ================================================================================= -->
	<!-- QUERIES INVOLVING BOTH msSearchDatabase AND msSequenceDatabaseDetails TABLEs -->
	<!-- ================================================================================= -->
	<select id="selectSearchDatabases" resultMap="msDatabaseResult" parameterClass="Integer">
		SELECT * FROM msSequenceDatabaseDetail as db, msSearchDatabase as searchDb
		WHERE db.id = searchDb.databaseID
		AND searchDb.searchID = #id#
	</select>
    
</sqlMap>