<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
      "http://ibatis.apache.org/dtd/sql-map-2.dtd"> 
<sqlMap namespace="PercolatorResult"> 

	
	<typeAlias alias="PercolatorResultOut" type="org.yeastrc.ms.domain.postsearch.percolator.impl.PercolatorResultBean" />
	<typeAlias alias="PercolatorResultIn" type="org.yeastrc.ms.domain.postsearch.percolator.PercolatorResultDataWId" />
	
	
	<resultMap class="PercolatorResultOut" id="percolatorResultResult" extends="MsSearchResult.msSearchResult">
		<result property="percoaltorOutputId" column="percOutputID" nullValue="0"/>
		<result property="qvalue" column="qvalue" nullValue="-1.0"/>
		<result property="posteriorErrorProbability" column="pep" nullValue="-1.0"/>
		<result property="discriminantScore" column="discriminantScore" nullValue="-1.0"/>
	</resultMap>
	
	<resultMap class="PercolatorResultOut" id="percolatorResultResultN" groupBy="id">
		<result property="id" column="id" />
		<result property="runSearchId" column="runSearchID" nullValue="0"/>
		<result property="scanId" column="scanID" nullValue="0"/>
		<result property="charge" column="charge" nullValue="0"/>
		<result property="validationStatus" column="validationStatus" typeHandler="VStatusHandler"/>
		<result property="resultPeptide" resultMap="MsSearchResult.msSearchResultPeptideResult" />
		<result property="percoaltorOutputId" column="percOutputID" nullValue="0"/>
		<result property="qvalue" column="qvalue" nullValue="-1.0"/>
		<result property="posteriorErrorProbability" column="pep" nullValue="-1.0"/>
		<result property="discriminantScore" column="discriminantScore" nullValue="-1.0"/>
	</resultMap>
	
	<parameterMap class="PercolatorResultIn" id="percolatorResultParam">
		<parameter property="resultId" jdbcType="INTEGER" nullValue="0" />
		<parameter property="percoaltorOutputId" jdbcType="INTEGER" nullValue="0" />
		<parameter property="qvalue" jdbcType="DOUBLE" nullValue="-1.0"/>
		<parameter property="posteriorErrorProbability" jdbcType="DOUBLE" nullValue="-1.0"/>
		<parameter property="discriminantScore" jdbcType="DOUBLE" nullValue="-1.0"/>
	</parameterMap>
	
	
    <select id="select" resultMap="percolatorResultResult" parameterClass="Integer">
		SELECT * FROM msRunSearchResult, PercolatorResult 
		WHERE PercolatorResult.resultID = msRunSearchResult.id
		AND msRunSearchResult.id = #id#
	</select>
    
    <select id="selectResultIdsForPercolatorOutput" resultClass="Integer" parameterClass="Integer">
    	SELECT resultID FROM PercolatorResult
    	WHERE percOutputID = #percOutputId# 
    </select>
    
    <select id="selectResultIdsForRunSearch" resultClass="Integer" parameterClass="Integer">
    	SELECT pres.resultID 
    	FROM PercolatorResult AS pres, msRunSearchResult as res
    	WHERE pres.resultID = res.resultID
    	AND res.runSearchID = #runSearchId#
    </select>
    
    <select id="selectResultIdsWQvalThreshold" resultClass="Integer" parameterClass="java.util.Map">
    	SELECT resultID FROM PercolatorResult
    	WHERE percOutputID = #percOutputId# 
    	AND qvalue <= #qvalue#
    </select>
    
    <select id="selectResultIdsWPepThreshold" resultClass="Integer" parameterClass="java.util.Map">
    	SELECT resultID FROM PercolatorResult
    	WHERE percOutputID = #percOutputId# 
    	AND pep <= #pep#
    </select>
    
    
    <insert id="insert" parameterMap="percolatorResultParam">
    	INSERT INTO PercolatorResult 
    	(resultID, 
    	percOutputID,
    	qvalue,
    	pep,
    	discriminantScore) 
    	VALUES (?,?,?,?,?)
    </insert>
    
    <insert id="insertAll" parameterClass="String">
    	INSERT INTO PercolatorResult 
    	(resultID, 
    	percOutputID,
    	qvalue,
    	pep,
    	discriminantScore) 
    	VALUES $values$
    </insert>
    
</sqlMap>