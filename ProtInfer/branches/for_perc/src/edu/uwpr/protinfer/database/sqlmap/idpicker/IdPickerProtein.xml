<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
      "http://ibatis.apache.org/dtd/sql-map-2.dtd"> 
<sqlMap namespace="IdPickerProtein"> 

	<typeAlias alias="IdPickerProtein" type="edu.uwpr.protinfer.database.dto.idpicker.IdPickerProtein" />
	<typeAlias alias="IdPickerProteinBase" type="edu.uwpr.protinfer.database.dto.idpicker.IdPickerProteinBase" />
	
	<resultMap class="IdPickerProteinBase" id="baseResult" extends="ProteinferProtein.pinferBaseProteinResult">
		<result property="clusterId" column="clusterID" nullValue="0"/>
		<result property="isParsimonious" column="isParsimonious" />
		<result property="groupId" column="groupID" nullValue="0"/>
	</resultMap>
	
	<resultMap class="IdPickerProtein" id="idpickerProteinResult" extends="IdPickerProtein.baseResult">
		<result property="peptides" 
				select="IdPickerPeptide.selectPeptidesForProtein"
				column="id"/>
	</resultMap>
	
	<resultMap class="IdPickerProteinBase" id="idpickerBaseProteinResult" extends="IdPickerProtein.baseResult">
		<result property="peptides" 
				select="IdPickerPeptide.selectBasePeptidesForProtein"
				column="id"/>
	</resultMap>
	
	<parameterMap class="IdPickerProteinBase" id="idpickerProteinParam">
		<parameter property="id" jdbcType="INTEGER" nullValue="0"/>
		<parameter property="isParsimonious" jdbcType="TINYINT" />
		<parameter property="clusterId" jdbcType="INTEGER" nullValue="0"/>
		<parameter property="groupId" jdbcType="INTEGER" nullValue="0"/>
	</parameterMap>
	
	<select id="select" resultMap="idpickerProteinResult" parameterClass="Integer">
    	SELECT * FROM msProteinInferProtein as prot, IDPickerProtein as idpProt
    	WHERE prot.id = idpProt.piProteinID
    	AND prot.id=#id#
    </select>
    
    <select id="selectBaseProtein" resultMap="idpickerBaseProteinResult" parameterClass="Integer">
    	SELECT * FROM msProteinInferProtein as prot, IDPickerProtein as idpProt
    	WHERE prot.id = idpProt.piProteinID
    	AND prot.id=#id#
    </select>
    
    
    
    <select id="selectProteinsForProteinferRun" resultMap="idpickerProteinResult" parameterClass="Integer">
    	SELECT * FROM msProteinInferProtein as prot, IDPickerProtein as idpProt
    	WHERE prot.id = idpProt.piProteinID
    	AND prot.piRunID = #id#
    </select>
    
    <select id="selectBaseProteinsForProteinferRun" resultMap="idpickerBaseProteinResult" parameterClass="Integer">
    	SELECT * FROM msProteinInferProtein as prot, IDPickerProtein as idpProt
    	WHERE prot.id = idpProt.piProteinID
    	AND prot.piRunID = #id#
    </select>
    
    
    
    <select id="selectProteinsForCluster" resultMap="idpickerProteinResult" parameterClass="java.util.Map">
    	SELECT * FROM msProteinInferProtein as prot, IDPickerProtein as idpProt
    	WHERE prot.id = idpProt.piProteinID
    	AND prot.piRunID = #pinferId#
    	AND idpProt.clusterID = #clusterId#
    </select>
    
    <select id="selectBaseProteinsForCluster" resultMap="idpickerBaseProteinResult" parameterClass="java.util.Map">
    	SELECT * FROM msProteinInferProtein as prot, IDPickerProtein as idpProt
    	WHERE prot.id = idpProt.piProteinID
    	AND prot.piRunID = #pinferId#
    	AND idpProt.clusterID = #clusterId#
    </select>
    
    
    
    <select id="selectProteinsForGroup" resultMap="idpickerProteinResult" parameterClass="java.util.Map">
    	SELECT * FROM msProteinInferProtein as prot, IDPickerProtein as idpProt
    	WHERE prot.id = idpProt.piProteinID
    	AND prot.piRunID = #pinferId#
    	AND idpProt.groupID = #groupId#
    </select>
    
    <select id="selectBaseProteinsForGroup" resultMap="idpickerBaseProteinResult" parameterClass="java.util.Map">
    	SELECT * FROM msProteinInferProtein as prot, IDPickerProtein as idpProt
    	WHERE prot.id = idpProt.piProteinID
    	AND prot.piRunID = #pinferId#
    	AND idpProt.groupID = #groupId#
    </select>
    
    
    
    <select id="selectPeptGrpIdsForProtGrpId" resultClass="Integer" parameterClass="java.util.Map">
    	SELECT peptideGroupID FROM IDPickerGroupAssociation
    	WHERE piRunID=#pinferId#
    	AND proteinGroupID=#groupId#
    </select>
    
    <select id="selectProtGrpIdsForClusterId" resultClass="Integer" parameterClass="java.util.Map">
    	SELECT DISTINCT idpProt.groupID 
    	FROM IDPickerProtein as idpProt, msProteinInferProtein as prot
    	WHERE prot.piRunID = #pinferId# 
    	AND idpProt.clusterID = #clusterId#
    	AND prot.id = idpProt.piProteinID
    </select>
    
    
    <select id="selectParsimProteinCountForProteinferRun" resultClass="Integer" parameterClass="Integer">
    	SELECT count(*) FROM msProteinInferProtein as prot, IDPickerProtein as idpProt 
    	WHERE prot.piRunID = #id# 
    	AND prot.id = idpProt.piProteinID
    	AND idpProt.isParsimonious = 1
    </select>
    
    <select id="checkGroupAssociation" resultClass="Integer" parameterClass="java.util.Map">
    	SELECT count(*) FROM IDPickerGroupAssociation
    	WHERE piRunID=#pinferId#
    	AND proteinGroupID=#protGrpId#
    	AND peptideGroupID=#peptGrpId#
    </select>
    
    <insert id="insertGroupAssociation" parameterClass="java.util.Map">
    	INSERT INTO IDPickerGroupAssociation (
    	piRunID,
    	proteinGroupID,
    	peptideGroupID)
    	values(#pinferId#, #protGrpId#, #peptGrpId#)
    </insert>
    
    <insert id="insert" parameterMap="idpickerProteinParam">
    	INSERT INTO IDPickerProtein (
    	piProteinID,
    	isParsimonious,
    	clusterID,
    	groupID) 
    	VALUES (?,?,?,?)
    </insert>
    
    <delete id="delete" parameterClass="Integer">
		DELETE FROM msProteinInferProtein WHERE id=#id#		    
    </delete>
    
</sqlMap>