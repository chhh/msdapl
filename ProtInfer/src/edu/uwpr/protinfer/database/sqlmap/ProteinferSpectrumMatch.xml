<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
      "http://ibatis.apache.org/dtd/sql-map-2.dtd"> 
<sqlMap namespace="ProteinferSpectrumMatch"> 

	<typeAlias alias="ProteinferSpectrumMatch" type="edu.uwpr.protinfer.database.dto.ProteinferSpectrumMatch"/>
	
	<resultMap class="ProteinferSpectrumMatch" id="pinferSMatchResult">
		<result property="id" column="id" nullValue="0"/>
		<result property="msRunSearchResultId" column="msRunSearchResultID" nullValue="0"/>
		<result property="proteinferPeptideId" column="pinferPeptideID" nullValue="0"/>
		<result property="rank" column="rank" nullValue="0"/>
	</resultMap>
	
	<parameterMap class="ProteinferSpectrumMatch" id="pinferSMatchParam">
		<parameter property="msRunSearchResultId" jdbcType="INTEGER" nullValue="0"/>
		<parameter property="proteinferPeptideId" jdbcType="INTEGER" nullValue="0"/>
		<parameter property="rank" jdbcType="INTEGER" nullValue="0" />
	</parameterMap>
	
    <select id="selectSpectrumMatch" resultMap="pinferSMatchResult" parameterClass="Integer">
    	SELECT * FROM proteinferSpectrumMatch WHERE id = #id#
    </select>
    
    <select id="selectMatchesForPeptide" resultMap="pinferSMatchResult" parameterClass="Integer">
    	SELECT * FROM proteinferSpectrumMatch WHERE pinferPeptideID = #id#
    </select>
    
    <select id="selectMatchIdsForPinferId" resultClass="Integer" parameterClass="Integer">
    	SELECT psm.msRunSearchResultID FROM proteinferSpectrumMatch as psm, proteinferPeptide as pep
    	WHERE pep.id = psm.pinferPeptideID 
    	AND pep.pinferId= #id#
    </select>
    
    <select id="selectMatchesForPinferIdAndRunSearch" resultMap="pinferSMatchResult" parameterClass="java.util.Map">
    	SELECT * FROM proteinferSpectrumMatch as psm, proteinferPeptide as pept, msRunSearchResult as msRes
    	WHERE pept.pinferID=#pinferId#
    	AND pept.id = psm.pinferPeptideID
    	AND psm.msRunSearchResultID = #msRunSearchResultId#
    	AND psm.msRunSearchResultID = msRes.id
    	AND msRes.runSearchID = #runSearchId#
    </select>
    
    <insert id="insert" parameterMap="pinferSMatchParam">
    	INSERT INTO proteinferSpectrumMatch (
    	msRunSearchResultID,
    	pinferPeptideID,
    	rank) 
    	VALUES (?,?,?)
    	<selectKey resultClass="int">
      		select last_insert_id() as id
    	</selectKey>
    </insert>
    
</sqlMap>