<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
      "http://ibatis.apache.org/dtd/sql-map-2.dtd"> 
<sqlMap namespace="ProteinferSpectrumMatch"> 

	<typeAlias alias="ProteinferSpectrumMatch" type="edu.uwpr.protinfer.database.dto.ProteinferSpectrumMatch"/>
	
	<resultMap class="ProteinferSpectrumMatch" id="pinferSMatchResult">
		<result property="id" column="id" nullValue="0"/>
		<result property="msRunSearchResultId" column="msRunSearchResultID" nullValue="0"/>
		<result property="proteinferPeptideId" column="piPeptideID" nullValue="0"/>
	</resultMap>
	
	<parameterMap class="ProteinferSpectrumMatch" id="pinferSMatchParam">
		<parameter property="msRunSearchResultId" jdbcType="INTEGER" nullValue="0"/>
		<parameter property="proteinferPeptideId" jdbcType="INTEGER" nullValue="0"/>
	</parameterMap>
	
    <select id="selectSpectrumMatch" resultMap="pinferSMatchResult" parameterClass="Integer">
    	SELECT * FROM msProteinInferSpectrumMatch WHERE id = #id#
    </select>
    
    <select id="selectMatchesForPeptide" resultMap="pinferSMatchResult" parameterClass="Integer">
    	SELECT * FROM msProteinInferSpectrumMatch WHERE piPeptideID = #id#
    </select>
    
    <select id="selectMatchIdsForPinferId" resultClass="Integer" parameterClass="Integer">
    	SELECT psm.msRunSearchResultID 
    	FROM msProteinInferSpectrumMatch AS psm, 
    	msProteinInferPeptide AS pep
    	msProteinInferProteinPeptideMatch AS match,
    	msProteinInferProtein AS prot
    	WHERE prot.piRunID=#id#
    	AND prot.id = match.piProteinID
    	AND match.pepID = pep.id
    	AND pep.id = psm.piPeptideID
    </select>
    
    <select id="selectMatchesForPinferIdAndRunSearch" resultMap="pinferSMatchResult" parameterClass="java.util.Map">
    	SELECT * 
    	FROM msProteinInferSpectrumMatch AS psm, 
    	msProteinInferPeptide AS pept, 
    	msProteinInferProtein as prot,
    	msProteinInferProteinPeptideMatch as match,
    	msProteinInferInput as input
    	WHERE input.runSearchID=#runSearchId#
    	AND input.piRunID=#id#
    	AND input.piRunID=prot.piRunID
    	AND prot.id = match.piProteinID
    	AND match.pepID = pep.id
    	AND pep.id = psm.piPeptideID
    </select>
    
    <insert id="insert" parameterMap="pinferSMatchParam">
    	INSERT INTO msProteinInferSpectrumMatch (
    	msRunSearchResultID,
    	piPeptideID) 
    	VALUES (?,?)
    	<selectKey resultClass="int">
      		select last_insert_id() as id
    	</selectKey>
    </insert>
    
</sqlMap>